<?xml version="1.0" encoding="UTF-8"?>
<div class="templates:surround?with=templates/page.html&amp;at=content">
    <script src="$app-root/resources/js/tablesorter/js/jquery.tablesorter.js"/>
    <script src="$app-root/resources/js/tablesorter/js/jquery.tablesorter.widgets.js"/>
    <script src="$app-root/resources/js/tablesorter/js/jquery.tablesorter.pager.js"/>
    <link rel="stylesheet" type="text/css" href="$app-root/resources/js/tablesorter/css/theme.bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="$app-root/resources/js/tablesorter/css/jquery.tablesorter.pager.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"/>
    <script> $(function() { $("table").tablesorter({ theme : "bootstrap", widthFixed: false,
        headerTemplate : '{content} {icon}', widgets : [ "uitheme", "filter", "zebra" ], filter_cssFilter: "form-control", }) }); 
    </script>
    <style>
        #mapid { height: 500px; }
    </style>
    <div class="panel panel-default">
        <div class="panel-heading">
            <h1>Orte <small>
                    <span id="searchstring"/>
                </small>
                <button id="reset" type="button" class="btn btn-primary btn-sm" style="float: right;">Reset!</button>
                <button id="visualize" type="button" class="btn btn-primary btn-lg" style="float: right;">Visualize!</button>
            </h1>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-7">
                    <table class="table table-striped table-condensed table-hover">
                        <thead>
                            <tr>
                                <th class="header">
                                    Ortsname (normalisiert)
                                </th>
                                <th>
                                    Alternative Schreibweisen
                                </th>
                                <th>
                                    Getty ID
                                </th>
                                <th>
                                    GPS
                                </th>
                            </tr>
                        </thead>
                        <tr data-template="app:listPlace"/>
                    </table>
                </div>
                <div class="col-md-5">
                    <div id="mapid"/>
                </div>
            </div>
        </div>
    </div>
    <script>
        $( "#visualize" ).click(function() {
        var map = L.map('mapid').setView([48.69096, 9.14062], 5); 
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.light',
        accessToken: 'pk.eyJ1Ijoic2VubmllcmVyIiwiYSI6ImNpbHk1YWV0bDAwZnB2dW01d2l1Y3phdmkifQ.OljQLEhqeAygai2y6VoSwQ'
        }).addTo(map);
        
        var rows = $("tr:visible").slice( 2 ) ;
        
        franzi = []
        rows.each(function (index, value) {
        var place_name = $(value).find('a').first().text().trim();
        var coordinates = ($(value).find('geo').first().text().trim()).split(' ');
        var getty_id = $(value).find('idno').first().text().trim();
        var place = {
            orig_name : place_name,
            gps : coordinates,
            getty :getty_id
        };
        franzi.push(place);
        });
        
        console.log(franzi);
        
        L.marker([47.7667, 18.7])
        .addTo(map)
        .bindPopup(franzi[0].place_name);
        return map;
        });

    </script>
    <script>

        $( document ).ready(function() {
       
        $("td input").bind("keyup", function(e) {
        var sumsi = [47.7667, 18.7];
            
            var all_rows = $("tr").length -2;
            var col_id = $(this).parent().attr('data-column');
            var searchstring = $(this).val();
            var filtered_rows = all_rows - $("tr[class*='filtered']").length ;
                $('#filtered').text(filtered_rows);
                $('#all').text(all_rows);
                $('#searchstring').text("'"+searchstring+"' kommt "+filtered_rows+ "mal vor.");
            });
         });
    </script>
</div>